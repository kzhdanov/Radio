(function(b,c,d){c.Radio=function(e,f){this.$el=c(f);this._init(e)};c.Radio.defaults={fallbackMessage:"HTML5 audio not supported",initialVolume:0.3,url:"http://eu3.radioboss.fm:8013/live",};c.Radio.prototype={_init:function(f){var e=this;this.options=c.extend(true,{},c.Radio.defaults,f);this.songs="";this.$loader=this.$el.find("div.vc-loader").show();c.when(this._createPlay()).done(function(){e.$loader.hide();e._createPlayer();e.sound=new c.Sound();e._loadEvents()})},_createPlay:function(){var e=this;var f=new c.Song();c.when(f.loadMetadata()).done(function(g){e.songs=g})},_createPlayer:function(){this.$audioEl=c('<audio id="audioElem"><span>'+this.options.fallbackMessage+"</span></audio>");this.$el.prepend(this.$audioEl);this.audio=this.$audioEl.get(0);this._createControls()},_createControls:function(){var e=this;this.$controls=c('<ul class="vc-controls" style="display:none;"/>');this.$cPlay=c('<li class="vc-control-play">Play<span></span></li>');this.$cStop=c('<li class="vc-control-stop">Stop<span></span></li>');this.$controls.append(this.$cPlay).append(c('<li class="vc-control-empty"><span></span></li>')).append(this.$cStop).appendTo(this.$el);this.$volume=c('<div style="display:none;" class="vc-volume-wrap"><div class="vc-volume-control"><div class="vc-volume-knob"></div></div></div> ').appendTo(this.$el);if(document.createElement("audio").canPlayType){if(!document.createElement("audio").canPlayType("audio/mpeg")&&!document.createElement("audio").canPlayType("audio/ogg")){toastr.warning("wrong")}else{this.$controls.show();this.$volume.show();this.$volume.find("div.vc-volume-knob").knobKnob({snap:10,value:359*this.options.initialVolume,turn:function(g){e._changeVolume(g)}});this.audio.volume=this.options.initialVolume;var f=new c.Ajaxes();f.setTitleInterval(5000)}}},_loadEvents:function(){var e=this;this.$cPlay.on("mousedown",function(f){e._setButtonActive(c(this));e._play()});this.$cStop.on("mousedown",function(f){e._setButtonActive(c(this));e._stop()})},_setButtonActive:function(e){e.addClass("vc-control-pressed");setTimeout(function(){e.removeClass("vc-control-pressed")},100)},_prepare:function(e){this._clear();this.$audioEl.attr("src",c.Radio.defaults.url)},_updateButtons:function(f){var e="vc-control-active";this.$cPlay.removeClass(e);this.$cStop.removeClass(e);switch(f){case"play":this.$cPlay.addClass(e);break}},_changeVolume:function(e){this.audio.volume=e},_play:function(){var f=this;this._updateButtons("play");try{f._prepare(f.songs);c(this).off("canplay");f.audio.currentTime=0;f.audio.play();var g=new c.Rating();g.SetRating();g.SetClick();g.hoverOn();b.Play=true}catch(h){console.log(h)}},_stop:function(f){var e=new c.Rating();e.hoverOff();if(!f){this._updateButtons("stop")}this.audio.pause();this._clear()},_clear:function(){this.$audioEl.children("source").remove()},};c.Rating=function(){this._init()};c.Rating.prototype={ratintDiv:c(".Rating"),ratings:c(".Rating li"),ratingTitle:c(".Rating__Title"),url:"/Rating/Save",key:"i@#4rv98*oo#a12N$_RadioKey",_init:function(){this.setOpacity(true)},SetClick:function(){var f=this,e="";this.ratings.off("click");this.ratings.click(function(){f.hoverOff();f.ratings.off("click");try{var g=localStorage.getItem(f.key);if(!g){e=f.randomGuid();localStorage.setItem(f.key,e);f.saveRating(f.buildRating.call({shortGuid:e,ratings:f.ratings}))}else{f.saveRating(f.buildRating.call({shortGuid:g,ratings:f.ratings}))}}catch(h){console.log(h)}})},SetRating:function(){var e=this;if(!localStorage.getItem(this.key)){e._clean();e.hoverOn()}else{c.ajax({method:"POST",async:true,url:"/Rating/Get",data:{user:localStorage.getItem(this.key),album:c.trim(c(".js-album").text()),group:c.trim(c(".js-group").text()),},}).done(function(g){var f=0;if(Number(g.points)!==0){for(;f<g.points;f+=1){e.ratings[f].style.backgroundColor="#333"}e.hoverOff();e.ratings.off("click")}}).fail(function(f){console.log("Oh, something went wrong...")})}},buildRating:function(){return{autor:c.trim(c(".songInfo__group").text()),song:c.trim(c(".songInfo__song").text()),album:c.trim(c(".songInfo__album").text()),rate:[].slice.call(this.ratings).filter(function(f,g){return f.style["background-color"]!=="transparent"}).length,userTempId:this.shortGuid,}},saveRating:function(e){c.ajax({method:"POST",async:true,url:this.url,data:e,}).fail(function(f){console.log("Oh, something went wrong...")})},randomGuid:function(){return"xxxxxxxx-xxxx-4xxx".replace(/[xy]/g,function(g){var f=Math.random()*16|0,e=g=="x"?f:(f&3|8);return e.toString(16)})},_clean:function(){this.ratings.css({backgroundColor:"transparent"})},hoverOn:function(){this.ratings.mouseenter(function(){var e=c(this);c(".Rating li").each(function(f,g){if(g.id<=Number(e.attr("id"))){c(this).css({backgroundColor:"#333"})}})}).mouseleave(function(){var e=c(this);c(".Rating li").each(function(f,g){if(g.id<=Number(e.attr("id"))){c(this).css({backgroundColor:"transparent"})}})})},setOpacity:function(e){if(e){this.ratintDiv.css({opacity:".8"});this.ratingTitle.css({opacity:".5"})}else{this.ratintDiv.css({opacity:".3"});this.ratingTitle.css({opacity:".3"})}},hoverOff:function(){this.setOpacity(false);this.ratings.off("mouseenter mouseleave")},};c.Ajaxes=function(){};c.Ajaxes.prototype={url:"/",intervalId:0,setTitleInterval:function(f){this.setTitleAjax();var e=this;setTimeout(function(){if(c(".js-group").text()!==""){intervalId=setInterval(e.setTitleAjax.bind(e),f)}else{console.log("No available strim")}},20000)},setTitleAjax:function(){c.ajax({method:"POST",async:true,cache:false,crossDomain:false,url:this.url,}).done(function(f){if(f){if(f.type!=="error"){if(f.autor!==c.trim(c(".js-group").text())||f.songName!==c.trim(c(".js-song").text())||f.album!==c.trim(c(".js-album").text())){c(".js-group").empty().text(f.autor);c(".js-song").empty().text(f.songName);c(".js-album").empty().text(f.album);var e=new c.Rating();e._clean();if(!b.Play){e.hoverOff()}else{e.hoverOn();e.ratings.off("click");e.ratings.click(e.SetClick());e.SetRating()}}}else{toastr.error("Oh, something went wrong... Can't connect to stream.");if(this.intervalId!==0){clearInterval(this.intervalId)}}}else{toastr.error("Oh, something went wrong...")}}).fail(function(e){toastr.error("Oh, something went wrong...")})}};c.Song=function(){};c.Song.prototype={loadMetadata:function(){var e=this;var f=c("<audio/>");f.attr("preload","auto");f.attr("src","sounds/click.mp3");f.on("loadedmetadata",function(g){e.duration=f.get(0).duration})}};c.Sound=function(){this._init()};c.Sound.prototype={_init:function(){this.$audio=c("<audio/>").attr("preload","auto")},getSource:function(e){return"sounds/"+this.action+"."+e},play:function(h,f){var e=this;e.action=h;var g=e.getSource("mp3");e.$audio.attr("src",g);if(f){e.$audio.attr("loop",f)}else{e.$audio.removeAttr("loop")}e.$audio.on("canplay",function(i){c(this).get(0).play()})}};var a=function(e){toastr.error(e)};c.fn.radio=function(f){if(typeof f==="string"){var e=Array.prototype.slice.call(arguments,1);this.each(function(){var g=c.data(this,"cassette");if(!g){a("cannot call methods on cassette prior to initialization; attempted to call method '"+f+"'");return}if(!c.isFunction(g[f])||f.charAt(0)==="_"){a("no such method '"+f+"' for cassette instance");return}g[f].apply(g,e)})}else{this.each(function(){var g=c.data(this,"cassette");if(!g){c.data(this,"cassette",new c.Radio(f,this))}})}return this}})(window,jQuery);